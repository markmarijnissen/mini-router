function Router(t){var e=this;if(t=t||[],this._routes=[],this.current={route:null,params:null},t.routes)for(var s in t.routes)this.add(t.routes[s],s);this.base="",t.base&&(this.base=t.base,"/"!==this.base[0]&&(this.base="/"+this.base),"/"===this.base[this.base.length-1]&&(this.base=this.base.substr(0,this.base.length-1))),"function"==typeof t.callback&&(this._callback=t.callback),"undefined"==typeof t.html5&&(t.html5=!0),t.html5===!0&&"onpopstate"in window?(this.html5=!0,window.addEventListener("popstate",function(t){e.set(t.state.url,!0)})):(this.html5=!1,window.addEventListener("hashchange",function(){e.set(window.location.hash.substr(1),!0)})),(t.clickInterceptor||window.ClickInterceptor)&&this.setClickInterceptor(t.clickInterceptor||window.ClickInterceptor)}Router.prototype.normalize=function(t){return t=t||"/","#"===t[0]&&(t=t.substr(1)),t.substr(0,location.origin.length)===location.origin&&(t=t.substr(location.origin.length)),t.substr(0,this.base.length)===this.base&&(t=t.substr(this.base.length)),"/"!==t[0]&&(t="/"+t),t.length>1&&"/"===t[t.length-1]&&(t=t.substr(0,t.length-1)),t},Router.prototype.add=function(t,e){t=this.normalize(t);var s,r=t;for(s=0,len=this._routes.length;len>s;s++)if(this._routes[s].route===r)return void(this._routes[s]=e||this._callback);if("/*"===t)return this._otherwise=e||this._callback,t;var o,i=t.match(/:[a-zA-Z0-9]+/g)||[];for(o=i.map(function(t){return t.substr(1)}),s=i.length-1;s>=0;s--)t=t.replace(i[s],"([^/]+)");return t="^"+t.replace(/\//g,"\\/")+"$",this._routes.push({route:r,regex:new RegExp(t),params:o,callback:e||this._callback}),t},Router.prototype.setClickInterceptor=function(t){t(this)},Router.prototype.setCallback=function(t){this._callback=t},Router.prototype.set=function(t,e){var s=this.html5?location.href:location.hash.substr(1);t=this.normalize(t||s),this.html5&&!e?history.pushState({url:t},t,t):e||(location.hash=t);for(var r,o=!1,i=this._routes.length-1,n={};i>=0&&!o;)r=t.match(this._routes[i].regex),null!==r&&(o=!0,r=r.splice(1),this._routes[i].params.forEach(function(t){n[t]=r[t]}),this._routes[i].callback(n,this._routes[i].route),this.current.route=this._routes[i].route,this.current.params=n),i--;return!o&&this._otherwise&&(this._otherwise(n,"/*"),o=!0),o},module?module.exports=Router:window.Router=Router;